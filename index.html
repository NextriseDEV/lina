<!DOCTYPE html>
<html>
<head>
  <style>
    :root {
      --primary: #25D366;
      --primary-dark: #128C7E;
      --bg: #f8f9fa;
      --text: #2d3748;
      --border: #e2e8f0;
      --card-bg: #ffffff;
    }
    body { 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
      background: var(--bg); 
      color: var(--text);
      margin: 0; 
      padding: 20px; 
    }
    .app-container { 
      display: grid; 
      grid-template-columns: 300px 1fr 350px; 
      gap: 25px; 
      max-width: 1500px; 
      margin: auto; 
    }
    
    /* Sidebar e Controles */
    .sidebar { 
      background: white; 
      padding: 20px; 
      border-radius: 16px; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      border: 1px solid var(--border);
    }
    h3 { color: var(--primary-dark); margin-top: 0; font-size: 1.1rem; border-bottom: 2px solid var(--bg); padding-bottom: 10px; }
    
    .control-group { margin-bottom: 20px; }
    label { 
      display: block; 
      font-size: 0.85rem; 
      font-weight: 600; 
      margin-bottom: 8px; 
      color: #718096;
    }
    
    select {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background-color: #fff;
      font-size: 0.9rem;
      color: var(--text);
      transition: all 0.2s;
      margin-bottom: 10px;
      cursor: pointer;
    }
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 211, 102, 0.1);
    }

    /* Cards Arrast√°veis */
    .card-item {
      background: var(--card-bg);
      border: 2px solid var(--border);
      padding: 12px;
      border-radius: 10px;
      cursor: grab;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--primary-dark);
    }
    .card-item:hover {
      border-color: var(--primary);
      background: #f0fff4;
      transform: translateY(-2px);
    }
    .card-item:active { cursor: grabbing; }
    .card-item::before {
      content: '‚†ø';
      margin-right: 12px;
      color: #cbd5e0;
      font-size: 1.2rem;
    }

    /* √Årea do C√©rebro */
    .brain-zone {
      background: white; 
      border: 3px dashed #cbd5e0; 
      border-radius: 24px;
      padding: 40px; 
      text-align: center; 
      min-height: 450px;
      display: flex; 
      flex-direction: column; 
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    .brain-zone.dragover { 
      background: #f0fff4; 
      border-color: var(--primary); 
      transform: scale(1.01);
    }
    #selected-tags { display: flex; flex-wrap: wrap; gap: 8px; margin: 25px 0; justify-content: center; }
    .tag { 
      background: #e6fffa; 
      color: var(--primary-dark); 
      padding: 6px 14px; 
      border-radius: 12px; 
      font-size: 0.8rem;
      font-weight: 600;
      border: 1px solid rgba(37, 211, 102, 0.2);
    }

    .btn-gerar {
      background: var(--primary); 
      color: white; 
      border: none; 
      padding: 16px 40px;
      border-radius: 12px; 
      font-size: 1rem; 
      cursor: pointer; 
      font-weight: 700;
      box-shadow: 0 10px 15px -3px rgba(37, 211, 102, 0.3);
      transition: all 0.2s;
    }
    .btn-gerar:hover { background: var(--primary-dark); transform: translateY(-1px); }
    .btn-gerar:disabled { background: #cbd5e0; cursor: not-allowed; box-shadow: none; }

    /* Resultados e Bot√£o Copiar */
    .output-card {
      background: #fff; 
      padding: 18px; 
      border-radius: 16px; 
      margin-bottom: 20px;
      border-left: 6px solid var(--primary); 
      box-shadow: 0 4px 6px rgba(0,0,0,0.02);
    }
    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .output-header strong { font-size: 0.9rem; color: #4a5568; }
    
    .copy-btn {
      background: #edf2f7;
      border: 1px solid #cbd5e0;
      padding: 5px 12px;
      border-radius: 6px;
      font-size: 0.75rem;
      cursor: pointer;
      font-weight: 600;
      color: var(--primary-dark);
      transition: all 0.2s;
    }
    .copy-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }
    .copy-btn.copied { background: var(--primary-dark); color: white; }

    textarea { 
      width: 100%; 
      border: 1px solid #f7fafc; 
      outline: none; 
      resize: none; 
      font-size: 0.95rem; 
      color: #2d3748;
      line-height: 1.5;
      background: #fcfcfc;
    }
  </style>
</head>
<body>

<div class="app-container">
  <div class="sidebar">
    <h3>üìå Vari√°veis</h3>
    <small>Selecione e arraste para o c√©rebro</small>
    
    <div class="control-group">
      <label>Assunto:</label>
      <select id="select-assunto" onchange="atualizarCard('assunto')"></select>
      <div id="card-assunto" class="card-item" draggable="true" ondragstart="drag(event)" data-type="assunto">Carregando...</div>
    </div>

    <div class="control-group">
      <label>Tom de Voz:</label>
      <select id="select-tom" onchange="atualizarCard('tom')"></select>
      <div id="card-tom" class="card-item" draggable="true" ondragstart="drag(event)" data-type="tom">Carregando...</div>
    </div>

    <div class="control-group">
      <label>Link:</label>
      <select id="select-link" onchange="atualizarCard('link')"></select>
      <div id="card-link" class="card-item" draggable="true" ondragstart="drag(event)" data-type="link">Carregando...</div>
    </div>
  </div>

  <div class="brain-zone" id="dropzone" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
    <h2>üß† C√©rebro de IA</h2>
    <p>Monte sua estrutura aqui</p>
    <div id="selected-tags"></div>
    <button class="btn-gerar" onclick="gerarMensagens()">‚ú® Gerar 3 Varia√ß√µes</button>
    <div style="margin-top:15px;"><a href="#" onclick="location.reload()" style="font-size:0.7rem; color:#ccc;">Limpar C√©rebro</a></div>
  </div>

  <div id="results">
    <div class="output-card">
      <div class="output-header">
        <strong>Op√ß√£o 1</strong>
        <button class="copy-btn" onclick="copyText('res1')">üìã Copiar</button>
      </div>
      <textarea id="res1" rows="6" placeholder="Aguardando gera√ß√£o..."></textarea>
    </div>
    
    <div class="output-card">
      <div class="output-header">
        <strong>Op√ß√£o 2</strong>
        <button class="copy-btn" onclick="copyText('res2')">üìã Copiar</button>
      </div>
      <textarea id="res2" rows="6" placeholder="Aguardando gera√ß√£o..."></textarea>
    </div>

    <div class="output-card">
      <div class="output-header">
        <strong>Op√ß√£o 3</strong>
        <button class="copy-btn" onclick="copyText('res3')">üìã Copiar</button>
      </div>
      <textarea id="res3" rows="6" placeholder="Aguardando gera√ß√£o..."></textarea>
    </div>
  </div>
</div>

<script>
  let config = { assunto: '', tom: '', linkNome: '', linkUrl: '', especialista: 'Especialista Lina', saudacao: 'Ol√°!' };

  // --- CARREGAMENTO INICIAL ---
  window.onload = function() {
    google.script.run.withSuccessHandler(function(data) {
      preencherSelect('select-assunto', data.assuntos);
      preencherSelect('select-tom', data.tons); // Corrigido ID de select-tons para select-tom
      
      const selectLink = document.getElementById('select-link');
      data.links.forEach(l => {
        let opt = document.createElement('option');
        opt.value = l.url;
        opt.text = l.nome;
        selectLink.appendChild(opt);
      });
      
      // Atualiza os cards vis√≠veis logo ap√≥s preencher
      setTimeout(() => {
        atualizarCard('assunto');
        atualizarCard('tom');
        atualizarCard('link');
      }, 300);
    }).getConfiguracoes();
  };

  function preencherSelect(id, lista) {
    const sel = document.getElementById(id);
    lista.forEach(item => {
      let opt = document.createElement('option');
      opt.value = item;
      opt.text = item;
      sel.appendChild(opt);
    });
  }

  function atualizarCard(tipo) {
    const sel = document.getElementById('select-' + tipo);
    const card = document.getElementById('card-' + tipo);
    if (!sel || !card) return;
    
    const valText = sel.options[sel.selectedIndex]?.text || 'Selecione...';
    const valUrl = sel.value;
    
    card.innerText = valText;
    card.setAttribute('data-val', valText);
    if(tipo === 'link') card.setAttribute('data-url', valUrl);
  }

  // --- L√ìGICA DE DRAG & DROP ---
  function allowDrop(ev) { ev.preventDefault(); document.getElementById('dropzone').classList.add('dragover'); }
  function dragLeave(ev) { document.getElementById('dropzone').classList.remove('dragover'); }
  
  function drag(ev) {
    ev.dataTransfer.setData("type", ev.target.getAttribute('data-type'));
    ev.dataTransfer.setData("val", ev.target.getAttribute('data-val'));
    ev.dataTransfer.setData("url", ev.target.getAttribute('data-url') || '');
  }

  function drop(ev) {
    ev.preventDefault();
    document.getElementById('dropzone').classList.remove('dragover');
    const type = ev.dataTransfer.getData("type");
    const val = ev.dataTransfer.getData("val");
    const url = ev.dataTransfer.getData("url");

    config[type] = val;
    if(type === 'link') {
      config.linkNome = val;
      config.linkUrl = url;
    }

    const tag = document.createElement("div");
    tag.className = "tag";
    tag.innerHTML = `${type.toUpperCase()}: ${val}`;
    document.getElementById('selected-tags').appendChild(tag);
  }

  // --- GERA√á√ÉO E C√ìPIA ---
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzeq5E8oUDZn99AAh-j73SBVs_jgSwzEFkhu-BlZkZeg5lgQFQ-lI6_KJis2MrLK-jK/exec";

  function gerarMensagens() {
    const btn = document.querySelector('.btn-gerar');
    btn.innerText = "‚è≥ Consultando C√©rebro...";
    btn.disabled = true;

    fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify(config)
    })
    .then(res => res.json())
    .then(res => {
      document.getElementById('res1').value = res.v1 || '';
      document.getElementById('res2').value = res.v2 || '';
      document.getElementById('res3').value = res.v3 || '';
      btn.innerText = "‚ú® Gerar 3 Varia√ß√µes";
      btn.disabled = false;
    })
    .catch(err => {
      console.error(err);
      btn.innerText = "‚ú® Gerar 3 Varia√ß√µes";
      btn.disabled = false;
    });
  }

  function copyText(id) {
    const area = document.getElementById(id);
    area.select();
    document.execCommand('copy');
    
    const btn = event.currentTarget;
    const oldText = btn.innerText;
    btn.innerText = "‚úÖ Copiado!";
    btn.classList.add('copied');
    setTimeout(() => {
      btn.innerText = oldText;
      btn.classList.remove('copied');
    }, 2000);
  }
</script>

</body>
</html>
